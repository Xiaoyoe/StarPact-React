# 存储功能适配实现计划

## 1. 核心存储结构设计

### 1.1 目录结构
在用户选择的存储路径下创建以下目录结构：
```
[用户选择的存储路径]/
└── starpact-local/
    ├── video-playlists/       # 视频播放列表数据
    ├── gallery/               # 图片数据
    └── config/                # 应用配置数据
```

### 1.2 存储方案选择
- **视频播放列表**：使用 JSON 文件存储，支持中文路径处理
- **图片数据**：使用 JSON 文件存储图片元数据，实际图片文件保存在本地目录
- **应用配置**：使用 electron-store 存储，确保性能和可靠性

## 2. 实现步骤

### 2.1 存储路径管理
- 在 `store` 中添加 `storagePath` 状态管理
- 实现路径选择功能，使用 Electron 的对话框 API
- 自动创建 `starpact-local` 目录结构
- 验证路径的可写性和有效性

### 2.2 视频播放列表存储
- 创建 `video-playlists` 目录
- 实现视频列表的 JSON 序列化和反序列化
- 处理中文路径和文件名
- 实现视频列表的导入/导出功能
- 支持播放列表的持久化和加载

### 2.3 图片存储
- 创建 `gallery` 目录
- 实现图片元数据的 JSON 存储
- 处理图片文件的本地存储
- 实现图片的导入/导出功能
- 支持图片元数据的管理和检索

### 2.4 应用配置存储
- 创建 `config` 目录
- 集成 electron-store 进行配置管理
- 实现主题、布局等设置的持久化
- 支持配置的导入/导出

## 3. 技术实现细节

### 3.1 路径处理
- 使用 Node.js 的 `path` 模块处理路径
- 确保中文路径的正确编码和解码
- 实现路径的标准化和验证

### 3.2 数据序列化
- 使用 `JSON.stringify` 和 `JSON.parse` 进行数据序列化
- 处理特殊字符和中文
- 实现数据的版本控制

### 3.3 错误处理
- 实现路径权限检查
- 处理文件读写错误
- 实现数据迁移功能

### 3.4 性能优化
- 使用异步文件操作
- 实现数据缓存
- 优化大文件的处理

## 4. 集成点

### 4.1 设置页面
- 添加存储路径配置选项
- 实现路径选择对话框
- 显示当前存储路径状态

### 4.2 视频播放页面
- 集成播放列表的持久化
- 实现播放列表的自动加载和保存

### 4.3 图片 gallery 页面
- 集成图片的本地存储
- 实现图片的自动加载和保存

### 4.4 应用初始化
- 启动时检查存储路径配置
- 自动创建必要的目录结构
- 加载持久化数据

## 5. 实现重点

- **中文路径处理**：确保所有路径操作支持中文
- **数据一致性**：确保数据的可靠存储和加载
- **用户体验**：实现无缝的数据持久化，用户无需手动保存
- **错误恢复**：实现数据备份和恢复机制

## 6. 不包含的功能

- 聊天对话历史的持久化
- 模型配置的持久化
- 其他未明确要求的功能

## 7. 技术栈

- **前端**：React、TypeScript
- **存储**：Node.js fs 模块、electron-store
- **桌面集成**：Electron 对话框 API
- **状态管理**：Zustand

通过以上实现，确保应用数据的可靠持久化存储，同时提供良好的用户体验和错误处理机制。